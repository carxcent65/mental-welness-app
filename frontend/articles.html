<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Articles & Resources</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">Mental Wellness - Articles</header>

  <!-- NAV: include same nav HTML as other pages (code below) -->
  <nav class="site-nav">
    <a href="index.html">Home</a>
    <a href="mood.html">Mood</a>
    <a href="journal.html">Journal</a>
    <a href="meditation.html">Meditation</a>
    <a href="forum.html">Forum</a>
    <a href="articles.html">Articles</a>
  </nav>

  <div class="container">
    <h2>Articles & Resources</h2>

    <div id="articleList"></div>

    <h3>Add Article (Instructor / Admin only)</h3>
    <input id="art_title" placeholder="Title"><br>
    <input id="art_summary" placeholder="Short summary"><br>
    <textarea id="art_content" placeholder="Full content (optional)"></textarea><br>
    <input id="art_source" placeholder="Source URL (optional)"><br>
    <button onclick="saveArticle()">Add Article</button>
  </div>

  <script>
    const API = 'http://127.0.0.1:5000';

    async function loadArticles() {
      const res = await fetch(`${API}/get_articles`);
      const articles = await res.json();
      const container = document.getElementById('articleList');
      if (!articles || articles.length === 0) {
        container.innerHTML = '<p>No articles yet.</p>';
        return;
      }
      container.innerHTML = articles.map(a => `
        <div class="article-card">
          <h3>${a.title}</h3>
          <p><em>${a.summary || ''}</em></p>
          <p>${a.content ? a.content.substring(0, 500) : ''}</p>
          ${a.source_url ? `<p><a href="${a.source_url}" target="_blank">Read more</a></p>` : ''}
          <small>${a.date}</small>
        </div>
      `).join('');
    }

    async function saveArticle() {
      const payload = {
        title: document.getElementById('art_title').value,
        summary: document.getElementById('art_summary').value,
        content: document.getElementById('art_content').value,
        source_url: document.getElementById('art_source').value
      };
      if (!payload.title) {
        alert('Title required');
        return;
      }
      await fetch(`${API}/add_article`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
      });
      // clear form
      document.getElementById('art_title').value = '';
      document.getElementById('art_summary').value = '';
      document.getElementById('art_content').value = '';
      document.getElementById('art_source').value = '';
      loadArticles();
    }

    loadArticles();
  </script>
</body>
</html>
